<%- include("../partials/header", {isAuthenticated}) -%>
<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v10.0" nonce="aDn2woTH"></script>
<div class="container-fluid">
    <div class="share-dialog">
        <header>
          <h3 class="dialog-title d-inline-block">Share this post</h3>
          <button class="close-button float-end"><svg><use href="#close"></use></svg></button>
        </header>
        <div class="targets">
            <iframe src="https://www.facebook.com/plugins/share_button.php?href=https%3A%2F%2Fword-nook.herokuapp.com%2Fposts%2F<%= id %>&layout=button&size=large&width=77&height=28&appId" width="77" height="28" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowfullscreen="true" allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share"></iframe>
          <a target="_blank" href="https://twitter.com/intent/tweet?text=Checkout%20this%20blog%20at%20WordNook&url=<%= `https://word-nook.herokuapp.com/posts/${id}` %>">
            <svg>
              <use href="#twitter"></use>
            </svg>
            <span>Twitter</span>
          </a>
          
          <a >
            <script src="https://platform.linkedin.com/in.js" type="text/javascript">lang: en_US</script>
            <script type="IN/Share" data-url="<%= `https://word-nook.herokuapp.com/posts/${id}` %>"></script>
          </a>
          
          <a href="mailto:?subject=Blogs on WordNook&amp;body=Check out this post at Wordnook <%= `https://word-nook.herokuapp.com/posts/${id}` %>">
            <svg>
              <use href="#email"></use>
            </svg>
            <span>Email</span>
          </a>
        </div>
        <div>
          <input class="form-control w-75 d-inline-block" value="<%= `https://word-nook.herokuapp.com/posts/${id}` %>" id="link"/>
          <button class="btn btn-primary float-end" onclick="copy()">Copy Link</button>
        </div>
      </div>
      <svg class="hidden">
        <defs>
          <symbol id="twitter" viewBox="0 0 24 24" fill="#1da1f2" stroke="#1da1f2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></symbol>
          
          <symbol id="email" viewBox="0 0 24 24" fill="#777" stroke="#fafafa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></symbol>

          <symbol id="close" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x-square"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="9" y1="9" x2="15" y2="15"></line><line x1="15" y1="9" x2="9" y2="15"></line></symbol>
        </defs>
      </svg>
    <div class="row align-items-start">
        <div class="col-lg-6 card mx-2 mx-lg-auto p-0">
            <div class="card-header p-1 text-center">
                <h1 class="my-0 heading-bold"> <%= title %> </h1>
                <% if (category) { %>
                    <div class="badge badge-pill badge-danger py-1 px-2">
                        <%= category %> 
                    </div>
                <% } %>
            </div>
            <div class="card-content p-2">
                <!-- If there is an image attached with the post then only render the image -->
                <% if(photo){ %>
                    <img src="..\<%- photo %>" alt="Image attached with the post" class="img-fluid pb-2" id="blog-image">
                <% } %>
                <%- content %>
                <!-- If this user is the author then only render the delete button-->
                <% if(isAuthor){ %>
                    <div class="d-block d-md-flex">
                        <button onclick="window.location.href='/posts/<%=id%>/edit'" type="submit" class="button btn-sm edit my-1">Edit </button>
                        <form  action="/posts/<%=id%>/delete" method="post" >
                            <button class="button btn-sm  del my-1" type="submit">Delete</button>
                        </form>
                    </div>
                <% } %>
            </div>
            <div class="card-footer text-center">
                <p class="post-date-font">Posted on <%= moment(new Date(timestamps)).format("dddd, MMMM Do YYYY, h:mm:ss a") %> </p>
                <a class="author-name" href="/author/<%= author._id %> " class="p-2 mb-4">
                    <i class="fas fa-user"></i>
                    <%= author.userName %> 
                </a>
            </div>
        </div>
        <div class="col-lg-4 mx-1 mx-md-auto">
            <!-- number of comments -->
            <h6 class="text-muted mt-4 mt-lg-0 fweight-600"> <%= comments.length %> <% if(comments.length>1 || comments.length===0) { %> comments <% } else  {%> comment <% } %></h6>
            
            <!-- like button -->
            <div class="like-btn">
              <div class="content">
                <span class="like_icon"></span>
                <div><%= likesCount %> <% if(likesCount>1 || likesCount===0) { %> likes <% } else  {%> like <% } %></div>
                <% if(!isLiked){ %>
                    <form action="/posts/<%=id%>/like?_method=PUT" method="POST">
                        <button class="button likebtn" type="submit"> Like</button>
                    </form>
                <% }else{ %>
                    <form action="/posts/<%=id%>/dislike?_method=PUT" method="POST">
                        <button class="button likebtn" type="submit">Liked</button>
                    </form>
                <% } %> 
                <button class="share-button">
                    Share
                </button>
                <div><%=noOfViews%> views</div>
              </div>
            </div>
            
            <!-- display all comments section -->
            <% for(var i=0; i<comments.length; i++) { %>
                <div class="comment"> 
                    <a href="/author/<%= comments[i].authorId  %> " class="mb-4">
                        <h5>
                            <i class="fas fa-user"></i>
                            <strong><%= comments[i].name %></strong>
                            <form class="float-end" action="/posts/<%=id%>/comments/<%=i%>/flag" method="post">
                                <% if(currentUser && comments[i].flags && comments[i].flags.includes(currentUser.userName)) { %>
                                    <button class="btn btn-flag" title="Flagged as Inappropriate" type="submit" disabled><i class="fas fa-flag"></i></button>    
                                <% }else{ %>
                                    <button class="btn btn-flag" title="Flag as Inappropriate" type="submit"><i class="fas fa-flag"></i></button>
                                <% } %>
                            </form>
                        </h5>
                    </a>
                    <p class="post-date-font"><%= moment(new Date(comments[i].timestamps*1000)).format("dddd, MMMM Do YYYY, h:mm:ss a") %></p>
                    <hr/>
                    <%- comments[i].content %>
                    <% if(currentUser && comments[i].authorId.toString() === currentUser._id.toString()){ %>
                        <form action="/posts/<%=id%>/comments/<%=i%>" method="post">
                            <button class="button  del" type="submit">Delete</button>
                        </form>
                    <% } %>
                </div>
            <% } %>

            <!-- add comment section -->
            <h3 class="normal-heading-font fweight-600">Add a comment</h3>
            <form action="/posts/<%=id%>/comment" method="POST" class="mb-4">
                <div class="form-group">
                    <label>Content</label>
                    <textarea name="content" ></textarea>
                    <script>
                        window.onload = function() {
                        CKEDITOR.replace('content');
                        };
                    </script>
                </div>
                <button class="button commenting" type="submit" name="publish">Post comment</button>
            </form>

        </div>
    </div>
</div>
<script src="https://cdn.ckeditor.com/4.11.1/standard/ckeditor.js"></script>
<script type="text/javascript" src="/js/postScript.js"></script>
<script type="text/javascript" src="/js/share.js"></script>

<%- include("../partials/footer") -%>

